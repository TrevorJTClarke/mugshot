var MUG=angular.module("mugshot",["ui.router","mugtemplates"]);MUG.directive("fadeIn",[function(){return{restrict:"A",link:function(e,t,r){var n=parseInt(r.fadeIn)||10;t.addClass("fade-in"),setTimeout(function(){t.css("opacity","1")},n)}}}]),MUG.directive("msgCenter",["$rootScope","$timeout","$compile",function(e,t,r){return{scope:{},link:function(n,o,i,c){function s(e){var o=+new Date,i=e.msg,c=e.icon?e.icon:g,s=f.replace("BODY",i).replace("ICON",c),v=r(s)(n);v[0].id=o,p=o,d.append(v);var j=d.find("#"+o);u(j,e.type),e.callback&&j.find(".msg-action").addClass("show"),t(function(){j.addClass("add")},20),l=t(function(){a(j)},m)}function a(e){if(!e&&p)e=d.find("#"+p);else if(!e)return;e.removeClass("add"),e.addClass("remove"),t(function(){angular.element(e).remove()},300)}function u(e,t){e.removeClass("msg-info"),e.removeClass("msg-warn"),t&&e.addClass("msg-"+t)}var l,f='<div class="msg" ng-click="action()"><div class="msg-icn"><i class="iw i-ICON"></i></div><div class="msg-cont">BODY</div><div class="msg-action"><i class="ib i-r-arrow"></i></div></div>',d=angular.element(o),m=5e3,p="",g="info";n.body="",n.callback=null,n.icon=g,n.action=function(){var e=d.find("#"+this.id);n.callback(),a(e)},e.$on("MSGCENTER:FIRE",function(e,t){t.msg&&(window.clearTimeout(l),a(),t.dur&&(m=1e3*t.dur),t.callback&&(n.callback=t.callback),s(t))})}}}]),MUG.directive("timeAgo",["timeAgoService","nowTimeService",function(e,t){return{restrict:"EA",link:function(r,n,o){var i;o.$observe("fromTime",function(t){i=e.parse(t)}),r.$watch(function(){return t.getTime()-i},function(t){angular.element(n).text(e.inWords(t))})}}}]),MUG.factory("nowTime",["$timeout",function(e){var t=Date.now(),r=function(){e(function(){t=Date.now(),r()},1e3)};return r(),{getTime:function(){return t}}}]);var fs=require("fs");MUG.factory("Projects",["$q",function(e){function t(e){return"number"==typeof e&&e===parseInt(e,10)&&(e=Array(e+1).join("x")),e.replace(/x/g,function(){var e=Math.round(61*Math.random())+48;return e=e>57?e+7>90?e+13:e+7:e,String.fromCharCode(e)})}function r(e){e=e||0;var r=t(12);return{id:r,title:"Project "+(parseInt(e,10)+1),timestamp:+new Date,totals:{success:null,warning:null,error:null,views:0}}}function n(e){t(12);return{id:e.id,title:e.title,timestamp:e.timestamp,viewports:[],selectors:[],cookies:[],meta:{url:null,readyEvent:null,delay:null,misMatchThreshold:null}}}var o=__dirname+"/projects.json",i=__dirname+"/projects/";return{createNew:function(){var t=e.defer(),c=JSON.parse(fs.readFileSync(o,"utf8")),s=r(c.length),a=n(s);return c.unshift(s),fs.writeFile(o,JSON.stringify(c),function(e){return e?void t.reject(e):void fs.writeFile(i+s.id+".json",JSON.stringify(a),function(e){return e?void t.reject(e):void t.resolve(s)})}),t.promise},getAll:function(){return JSON.parse(fs.readFileSync(o,"utf8"))},getById:function(e){return JSON.parse(fs.readFileSync(i+e+".json","utf8"))},save:function(t){var r=e.defer(),n=JSON.parse(fs.readFileSync(o,"utf8"));return n.map(function(e,r){e.id===t.id&&(n[r].title=t.title,n[r].timestamp=+new Date)}),fs.writeFile(i+t.id+".json",JSON.stringify(t),function(e){return e?void r.reject(e):void fs.writeFile(o,JSON.stringify(n),function(e){return e?void r.reject(e):void r.resolve(t)})}),r.promise},remove:function(t){var r=e.defer(),n=JSON.parse(fs.readFileSync(o,"utf8"));return n.map(function(e,r){e.id===t&&n.splice(r,1)}),fs.unlink(i+t+".json",function(e){return e?void r.reject(e):void fs.writeFile(o,JSON.stringify(n),function(e){return e?void r.reject(e):void r.resolve()})}),r.promise}}}]),MUG.factory("timeAgo",function(){function e(e){var t=e.toString().slice(0,13);return 13==t.length?parseInt(t):e}var t={};return t.settings={refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"%d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},t.inWords=function(e){function r(t,r){var o=angular.isFunction(t)?t(r,e):t,i=n.numbers&&n.numbers[r]||r;return o.replace(/%d/i,i)}var n=t.settings.strings,o=n.prefixAgo,i=n.suffixAgo;t.settings.allowFuture&&0>e&&(o=n.prefixFromNow,i=n.suffixFromNow);var c=Math.abs(e)/1e3,s=c/60,a=s/60,u=a/24,l=u/365,f=45>c&&r(n.seconds,Math.round(c))||90>c&&r(n.minute,1)||45>s&&r(n.minutes,Math.round(s))||90>s&&r(n.hour,1)||24>a&&r(n.hours,Math.round(a))||42>a&&r(n.day,1)||30>u&&r(n.days,Math.round(u))||45>u&&r(n.month,1)||365>u&&r(n.months,Math.round(u/30))||1.5>l&&r(n.year,1)||r(n.years,Math.round(l)),d=void 0===n.wordSeparator?" ":n.wordSeparator;return[o,f,i].join(d).trim()},t.parse=function(t){if(angular.isNumber(t)){t+="";var r=e(t);return parseInt(r,10)}var n=(t||"").trim();return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},t}),MUG.filter("timeAgo",["nowTime","timeAgo",function(e,t){return function(r){var n=t.parse(r),o=e.getTime()-n;return t.inWords(o)}}]),MUG.controller("MainCtrl",["$rootScope","$scope","$state","Config","Projects",function(e,t,r,n,o){e.currentProjectId="",t.createNewProject=function(){o.createNew().then(function(t){e.$broadcast("SIDEPANEL:NEWPROJECT",t),r.go("projects.settings",{id:t.id})},function(e){console.log("err",e)})}}]),MUG.controller("ProjectCtrl",["$rootScope","$scope","$stateParams","Projects",function(e,t,r,n){e.project=n.getById(r.id)}]),MUG.controller("ProjectHistoryCtrl",["$rootScope","$scope","Projects",function(e,t,r){}]),MUG.controller("ProjectRunnerCtrl",["$rootScope","$scope","Projects",function(e,t,r){}]),MUG.controller("ProjectSettingsCtrl",["$rootScope","$scope","$state","Projects",function(e,t,r,n){t.master={},angular.copy(e.project,t.master),t.save=function(){n.save(e.project).then(function(r){e.$emit("SIDEPANEL:UPDATE",r),angular.copy(e.project,t.master)},function(e){console.log("err",e)})},t.cancelSave=function(){var r=confirm("Are you sure you want to clear all your changes?");r&&angular.copy(t.master,e.project)},t.deleteProject=function(){var t=confirm("Are you sure you want to delete this project?");if(t){var o=e.project.id;n.remove(o).then(function(t){e.$emit("SIDEPANEL:REMOVE",{id:o}),r.go("main"),e.project={}},function(e){console.log("err",e)})}}}]);var fs=require("fs");MUG.controller("SidePanelCtrl",["$rootScope","$scope","$state","Projects",function(e,t,r,n){t.projects=[],t.projects=n.getAll(),e.$on("SIDEPANEL:NEWPROJECT",function(e,r){r&&r.id&&t.projects.unshift(r)}),e.$on("SIDEPANEL:UPDATE",function(e,r){r&&r.id&&t.projects.map(function(e,n){e.id===r.id&&(t.projects[n]=r)})}),e.$on("SIDEPANEL:REMOVE",function(e,r){r&&r.id&&t.projects.map(function(e,n){e.id===r.id&&t.projects.splice(n,1)})}),t.goToProject=function(t){var n="settings";r.go("projects."+n,{id:t}),e.currentProjectId=t}}]),MUG.constant("Config",{ENV:"STAGE",STAGE:{},PROD:{}}),MUG.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("main",{url:"/",templateUrl:"main.html"}).state("projects",{url:"/projects/:id",templateUrl:"projects.html",controller:"ProjectCtrl"}).state("projects.settings",{url:"/settings",templateUrl:"projects.settings.html",controller:"ProjectSettingsCtrl"}).state("projects.runner",{url:"/runner",templateUrl:"projects.runner.html",controller:"ProjectRunnerCtrl"}).state("projects.history",{url:"/history",templateUrl:"projects.history.html",controller:"ProjectHistoryCtrl"}),t.otherwise("/")}]),MUG.run(["$rootScope","$http",function(e,t){var r=t.defaults.headers.common;r["Content-Type"]="application/json",e.$on("$stateChangeError",function(e,t,r,n,o,i){console.log("$stateChangeError",i)})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImZhZGVpbi5qcyIsIm1zZ2NlbnRlci5qcyIsInRpbWVhZ28uanMiLCJub3d0aW1lLmpzIiwicHJvamVjdHMuanMiLCJ0aW1lLWFnby5qcyIsIm1haW5jdHJsLmpzIiwicHJvamVjdGN0cmwuanMiLCJwcm9qZWN0aGlzdG9yeWN0cmwuanMiLCJwcm9qZWN0cnVubmVyY3RybC5qcyIsInByb2plY3RzZXR0aW5nc2N0cmwuanMiLCJzaWRlcGFuZWxjdHJsLmpzIiwiY29uZmlnLmpzIiwicm91dGVzLmpzIiwiaW5pdC5qcyJdLCJuYW1lcyI6WyJNVUciLCJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJsaW5rIiwic2NvcGUiLCJlbGVtIiwiYXR0cnMiLCJvZmZzZXQiLCJwYXJzZUludCIsImZhZGVJbiIsImFkZENsYXNzIiwic2V0VGltZW91dCIsImNzcyIsIiRyb290U2NvcGUiLCIkdGltZW91dCIsIiRjb21waWxlIiwiZWwiLCJjdHJsIiwic2hvd01lc3NhZ2UiLCJkYXRhIiwiX2lkIiwiRGF0ZSIsIm5ld0JvZHkiLCJtc2ciLCJuZXdJY24iLCJpY29uIiwiZGVmYXVsdEljb24iLCJ0ZW1wbGF0ZSIsIm1zZ1RlbXBsYXRlIiwicmVwbGFjZSIsIm5ld01lc3NhZ2UiLCJpZCIsInByZXZpb3VzSWQiLCJfZWwiLCJhcHBlbmQiLCJtc2dFbCIsImZpbmQiLCJjaGFuZ2VUeXBlIiwidHlwZSIsImNhbGxiYWNrIiwidGltZXIiLCJjbGVhckVsIiwiZHVyYXRpb24iLCJyZW1vdmVDbGFzcyIsImVsZW1lbnQiLCJyZW1vdmUiLCJib2R5IiwiYWN0aW9uIiwiYWN0aW9uRWwiLCJ0aGlzIiwiJG9uIiwiZSIsIndpbmRvdyIsImNsZWFyVGltZW91dCIsImR1ciIsInRpbWVBZ28iLCJub3dUaW1lIiwiZnJvbVRpbWUiLCIkb2JzZXJ2ZSIsInZhbHVlIiwicGFyc2UiLCIkd2F0Y2giLCJnZXRUaW1lIiwidGV4dCIsImluV29yZHMiLCJmYWN0b3J5Iiwibm93IiwidXBkYXRlVGltZSIsImZzIiwicmVxdWlyZSIsIiRxIiwiY3JlYXRlVVVJRCIsInMiLCJBcnJheSIsImpvaW4iLCJuIiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiY3JlYXRlRHVtbXlQcm9qZWN0IiwidG90YWwiLCJwcm9qZWN0SWQiLCJ0aXRsZSIsInRpbWVzdGFtcCIsInRvdGFscyIsInN1Y2Nlc3MiLCJ3YXJuaW5nIiwiZXJyb3IiLCJ2aWV3cyIsImNyZWF0ZUR1bW15UHJvamVjdEZpbGUiLCJvcHRpb25zIiwidmlld3BvcnRzIiwic2VsZWN0b3JzIiwiY29va2llcyIsIm1ldGEiLCJ1cmwiLCJyZWFkeUV2ZW50IiwiZGVsYXkiLCJtaXNNYXRjaFRocmVzaG9sZCIsInByb2plY3RzUGF0aCIsIl9fZGlybmFtZSIsInByb2plY3RGaWxlc1BhdGgiLCJjcmVhdGVOZXciLCJkZmQiLCJkZWZlciIsImFsbFByb2plY3RzIiwiSlNPTiIsInJlYWRGaWxlU3luYyIsIm5ld1Byb2plY3REYXRhIiwibGVuZ3RoIiwibmV3UHJvamVjdEZpbGUiLCJ1bnNoaWZ0Iiwid3JpdGVGaWxlIiwic3RyaW5naWZ5IiwiZXJyIiwicmVqZWN0IiwicmVzb2x2ZSIsInByb21pc2UiLCJnZXRBbGwiLCJnZXRCeUlkIiwic2F2ZSIsInByb2plY3REYXRhIiwibWFwIiwib2JqIiwiaWR4Iiwic3BsaWNlIiwidW5saW5rIiwidHJpbURpZ2l0cyIsIm51bSIsIm0iLCJ0b1N0cmluZyIsInNsaWNlIiwic2VydmljZSIsInNldHRpbmdzIiwicmVmcmVzaE1pbGxpcyIsImFsbG93RnV0dXJlIiwic3RyaW5ncyIsInByZWZpeEFnbyIsInByZWZpeEZyb21Ob3ciLCJzdWZmaXhBZ28iLCJzdWZmaXhGcm9tTm93Iiwic2Vjb25kcyIsIm1pbnV0ZSIsIm1pbnV0ZXMiLCJob3VyIiwiaG91cnMiLCJkYXkiLCJkYXlzIiwibW9udGgiLCJtb250aHMiLCJ5ZWFyIiwieWVhcnMiLCJudW1iZXJzIiwiZGlzdGFuY2VNaWxsaXMiLCJzdWJzdGl0dXRlIiwic3RyaW5nT3JGdW5jdGlvbiIsIm51bWJlciIsInN0cmluZyIsImlzRnVuY3Rpb24iLCIkbCIsInByZWZpeCIsInN1ZmZpeCIsImFicyIsIndvcmRzIiwic2VwYXJhdG9yIiwidW5kZWZpbmVkIiwid29yZFNlcGFyYXRvciIsInRyaW0iLCJpc284NjAxIiwiaXNOdW1iZXIiLCJvcmlnaW5hbFRpbWVzdGFtcCIsImZpbHRlciIsImRpZmYiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiQ29uZmlnIiwiUHJvamVjdHMiLCJjdXJyZW50UHJvamVjdElkIiwiY3JlYXRlTmV3UHJvamVjdCIsInRoZW4iLCJyZXMiLCIkYnJvYWRjYXN0IiwiZ28iLCJjb25zb2xlIiwibG9nIiwiJHN0YXRlUGFyYW1zIiwicHJvamVjdCIsIm1hc3RlciIsImNvcHkiLCIkZW1pdCIsImNhbmNlbFNhdmUiLCJzdXJlIiwiY29uZmlybSIsImRlbGV0ZVByb2plY3QiLCJwcm9qZWN0SUQiLCJwcm9qZWN0cyIsImFyZ3MiLCJnb1RvUHJvamVjdCIsImNvbnN0YW50IiwiRU5WIiwiU1RBR0UiLCJQUk9EIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwib3RoZXJ3aXNlIiwicnVuIiwiJGh0dHAiLCIkY29tbW9uIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiZXZlbnQiLCJ0b1N0YXRlIiwidG9QYXJhbXMiLCJmcm9tU3RhdGUiLCJmcm9tUGFyYW1zIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLFdBQUEsWUFBQSxnQkNJQUYsS0FBQUcsVUFBQSxVQUFBLFdBQ0EsT0FDQUMsU0FBQSxJQUNBQyxLQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsU0FBQUYsRUFBQUcsU0FBQSxFQUNBSixHQUFBSyxT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LGNBTUFELE1BQUEsWUFDQS9HLElBQUEsZ0JBQ0FnSCxZQUFBLGdCQUNBbEMsV0FBQSxnQkFFQWlDLE1BQUEscUJBQ0EvRyxJQUFBLFlBQ0FnSCxZQUFBLHlCQUNBbEMsV0FBQSx3QkFFQWlDLE1BQUEsbUJBQ0EvRyxJQUFBLFVBQ0FnSCxZQUFBLHVCQUNBbEMsV0FBQSxzQkFFQWlDLE1BQUEsb0JBQ0EvRyxJQUFBLFdBQ0FnSCxZQUFBLHdCQUNBbEMsV0FBQSx1QkFzQkFnQyxFQUFBRyxVQUFBLFFDaEVBcE4sSUFBQXFOLEtBQUEsYUFBQSxRQUNBLFNBQUF0TSxFQUFBdU0sR0FHQSxHQUFBQyxHQUFBRCxFQUFBRSxTQUFBQyxRQUFBQyxNQUNBSCxHQUFBLGdCQUFBLG1CQUVBeE0sRUFBQXFDLElBQUEsb0JBQUEsU0FBQXVLLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFwSSxHQUNBaUcsUUFBQUMsSUFBQSxvQkFBQWxHIiwiZmlsZSI6Im11Zy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBNVUcgPSBhbmd1bGFyLm1vZHVsZSgnbXVnc2hvdCcsIFsndWkucm91dGVyJywgJ211Z3RlbXBsYXRlcyddKTtcbiIsIi8qKlxuICogZmFkZUluXG4gKiBBIGRpcmVjdGl2ZSBmb3IgYW5pbWF0aW5nIGluIGVsZW1lbnRzXG4gKi9cbk1VRy5kaXJlY3RpdmUoJ2ZhZGVJbicsIFsgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMpIHtcbiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBwYXJzZUludChhdHRycy5mYWRlSW4pIHx8IDEwO1xuICAgICAgICAgICAgZWxlbS5hZGRDbGFzcygnZmFkZS1pbicpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBlbGVtLmNzcyhcIm9wYWNpdHlcIiwgXCIxXCIpO1xuICAgICAgICAgICAgfSwgb2Zmc2V0KTtcbiAgICAgICAgfVxuICAgIH07XG59XSk7XG4iLCIvKipcbiAqIG1zZ0NlbnRlclxuICogYSBkaXJlY3RpdmUgZm9yIGhhbmRsaW5nIGFsbCBtZXNzYWdlIHJlbGF5IGZvciBhIHVzZXJcbiAqXG4gKiBVU0U6XG4gKiAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ01TR0NFTlRFUjpGSVJFJywgeyBtc2c6IFwiSGV5IHRoZXJlLCBJbSBhIG1lc3NhZ2UhIVwiLCBkdXI6IDUsIHR5cGU6IFwiaW5mb1wiLCBpY29uOiBcImluZm9cIiwgY2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSB9KTtcbiAqXG4gKiBUWVBFUzpcbiAqIC0gREVGQVVMVCwgc2hvd3MgZ3JlZW4gbWVzc2FnZSwgdXNlZCBmb3Igc3VjY2Vzc1xuICogLSBXYXJuaW5nOiBcIndhcm5cIiAtIHNob3dzIG9yYW5nZSBtZXNzYWdlLCB1c2VkIGZvciBlcnJvcnMgb3Igd2FybmluZ3NcbiAqIC0gSW5mbzogXCJpbmZvXCIgLSBzaG93cyBkYXJrIGJsdWUgbWVzc2FnZSwgdXNlZCBmb3IgZ2VuZXJhbCB0aGluZ3NcbiAqXG4gKiBPUFRJT05TOlxuICogLSBtc2c6IHRoZSBjb250ZW50cyBvZiB0aGUgbWVzc2FnZSwgKFRPRE86IGNhbiBiZSBodG1sIG9yIHNpbXBsZSB0ZXh0KVxuICogLSBjYWxsYmFjazogYSBmdW5jdGlvbiB0byBmaXJlIG9uIGFjdGlvbiB0YWtlbiBvbiBtZXNzYWdlXG4gKiAtIGR1cjogdGhlIHRpbWVvdXQgb2YgdGhlIG1lc3NhZ2VcbiAqIC0gdHlwZTogc2VlIGFib3ZlIHR5cGVzXG4gKiAtIGljb246IGRlZmF1bHQgaXMgZ2xvYmUsIGNhbiBiZSBzZXQgdG8gQU5ZIGktc3ByaXRlcyAoc3ByaXRlcy5sZXNzKVxuICovXG5NVUcuZGlyZWN0aXZlKCdtc2dDZW50ZXInLFxuWyBcIiRyb290U2NvcGVcIiwgXCIkdGltZW91dFwiLCBcIiRjb21waWxlXCIsXG5mdW5jdGlvbiAoJHJvb3RTY29wZSwgJHRpbWVvdXQsICRjb21waWxlKSB7XG4gIHJldHVybiB7XG4gICAgc2NvcGU6IHt9LFxuICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XG4gICAgICB2YXIgbXNnVGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1zZ1wiIG5nLWNsaWNrPVwiYWN0aW9uKClcIj4nK1xuICAgICAgICAgICc8ZGl2IGNsYXNzPVwibXNnLWljblwiPjxpIGNsYXNzPVwiaXcgaS1JQ09OXCI+PC9pPjwvZGl2PicrXG4gICAgICAgICAgJzxkaXYgY2xhc3M9XCJtc2ctY29udFwiPkJPRFk8L2Rpdj4nK1xuICAgICAgICAgICc8ZGl2IGNsYXNzPVwibXNnLWFjdGlvblwiPjxpIGNsYXNzPVwiaWIgaS1yLWFycm93XCI+PC9pPjwvZGl2PicrXG4gICAgICAgICc8L2Rpdj4nO1xuXG4gICAgICB2YXIgX2VsID0gYW5ndWxhci5lbGVtZW50KGVsKTtcbiAgICAgIHZhciB0aW1lcjtcbiAgICAgIHZhciBkdXJhdGlvbiA9IDUwMDA7XG4gICAgICB2YXIgcHJldmlvdXNJZCA9IFwiXCI7XG4gICAgICB2YXIgZGVmYXVsdEljb24gPSBcImluZm9cIjtcblxuICAgICAgc2NvcGUuYm9keSA9IFwiXCI7XG4gICAgICBzY29wZS5jYWxsYmFjayA9IG51bGw7XG4gICAgICBzY29wZS5pY29uID0gZGVmYXVsdEljb247XG4gICAgICBzY29wZS5hY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgYWN0aW9uRWwgPSBfZWwuZmluZChcIiNcIiArIHRoaXMuaWQpO1xuICAgICAgICBzY29wZS5jYWxsYmFjaygpO1xuICAgICAgICBjbGVhckVsKCBhY3Rpb25FbCApO1xuICAgICAgfTtcblxuICAgICAgZnVuY3Rpb24gc2hvd01lc3NhZ2UgKCBkYXRhICl7XG4gICAgICAgIHZhciBfaWQgPSAoK25ldyBEYXRlKCkpO1xuICAgICAgICB2YXIgbmV3Qm9keSA9IGRhdGEubXNnO1xuICAgICAgICB2YXIgbmV3SWNuID0gKGRhdGEuaWNvbik/IGRhdGEuaWNvbiA6IGRlZmF1bHRJY29uO1xuXG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IG1zZ1RlbXBsYXRlLnJlcGxhY2UoXCJCT0RZXCIsIG5ld0JvZHkpLnJlcGxhY2UoXCJJQ09OXCIsIG5ld0ljbik7XG4gICAgICAgIHZhciBuZXdNZXNzYWdlID0gJGNvbXBpbGUodGVtcGxhdGUpKHNjb3BlKTtcblxuICAgICAgICAvLyBzZXQgYSB1bmlxdWUgaWRcbiAgICAgICAgbmV3TWVzc2FnZVswXS5pZCA9IF9pZDtcbiAgICAgICAgcHJldmlvdXNJZCA9IF9pZDtcblxuICAgICAgICAvLyB0aHJvdyBpbnRvIGRvbSwgdGhlbiBzaG93IGluIHZpZXcsIHN0YXJ0IHRpbWVyXG4gICAgICAgIF9lbC5hcHBlbmQoIG5ld01lc3NhZ2UgKTtcblxuICAgICAgICAvLyByZW1lbWJlciB0aGUgbmV3IGVsIGZvciBsYXRlclxuICAgICAgICB2YXIgbXNnRWwgPSBfZWwuZmluZChcIiNcIiArIF9pZCk7XG4gICAgICAgIGNoYW5nZVR5cGUoIG1zZ0VsLCBkYXRhLnR5cGUgKTtcblxuICAgICAgICBpZihkYXRhLmNhbGxiYWNrKXtcbiAgICAgICAgICBtc2dFbC5maW5kKFwiLm1zZy1hY3Rpb25cIikuYWRkQ2xhc3MoXCJzaG93XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2hvd1xuICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBtc2dFbC5hZGRDbGFzcygnYWRkJyk7XG4gICAgICAgIH0sIDIwKTtcblxuICAgICAgICB0aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xlYXJFbCggbXNnRWwgKTtcbiAgICAgICAgfSwgZHVyYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjbGVhckVsICggZWxlbSApIHtcbiAgICAgICAgaWYoIWVsZW0gJiYgcHJldmlvdXNJZCl7XG4gICAgICAgICAgZWxlbSA9IF9lbC5maW5kKFwiI1wiICsgcHJldmlvdXNJZCk7XG4gICAgICAgIH0gZWxzZSBpZighZWxlbSkgeyByZXR1cm47IH1cblxuICAgICAgICBlbGVtLnJlbW92ZUNsYXNzKCdhZGQnKTtcbiAgICAgICAgZWxlbS5hZGRDbGFzcygncmVtb3ZlJyk7XG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgYW5ndWxhci5lbGVtZW50KGVsZW0pLnJlbW92ZSgpO1xuICAgICAgICB9LCAzMDApO1xuICAgICAgfVxuXG4gICAgICAvLyBzZXQgdGhlIHR5cGUgYnkgYSBjbGFzc1xuICAgICAgZnVuY3Rpb24gY2hhbmdlVHlwZSAoIGVsZW0sIHR5cGUgKSB7XG4gICAgICAgIGVsZW0ucmVtb3ZlQ2xhc3MoJ21zZy1pbmZvJyk7XG4gICAgICAgIGVsZW0ucmVtb3ZlQ2xhc3MoJ21zZy13YXJuJyk7XG5cbiAgICAgICAgaWYodHlwZSl7XG4gICAgICAgICAgZWxlbS5hZGRDbGFzcygnbXNnLScgKyB0eXBlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkcm9vdFNjb3BlLiRvbignTVNHQ0VOVEVSOkZJUkUnLCBmdW5jdGlvbihlLCBkYXRhKXtcbiAgICAgICAgaWYoIWRhdGEubXNnKXsgcmV0dXJuOyB9XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICBjbGVhckVsKCk7XG5cbiAgICAgICAgaWYoZGF0YS5kdXIpe1xuICAgICAgICAgIGR1cmF0aW9uID0gZGF0YS5kdXIgKiAxMDAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoZGF0YS5jYWxsYmFjayl7XG4gICAgICAgICAgc2NvcGUuY2FsbGJhY2sgPSBkYXRhLmNhbGxiYWNrO1xuICAgICAgICB9XG5cbiAgICAgICAgc2hvd01lc3NhZ2UoIGRhdGEgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbn1dKTtcbiIsIk1VRy5mYWN0b3J5KCd0aW1lQWdvJywgZnVuY3Rpb24gKCkge1xuICB2YXIgc2VydmljZSA9IHt9O1xuXG4gIHNlcnZpY2Uuc2V0dGluZ3MgPSB7XG4gICAgcmVmcmVzaE1pbGxpczogNjAwMDAsXG4gICAgYWxsb3dGdXR1cmU6IGZhbHNlLFxuICAgIHN0cmluZ3M6IHtcbiAgICAgIHByZWZpeEFnbzogbnVsbCxcbiAgICAgIHByZWZpeEZyb21Ob3c6IG51bGwsXG4gICAgICBzdWZmaXhBZ286ICdhZ28nLFxuICAgICAgc3VmZml4RnJvbU5vdzogJ2Zyb20gbm93JyxcbiAgICAgIHNlY29uZHM6ICdsZXNzIHRoYW4gYSBtaW51dGUnLFxuICAgICAgbWludXRlOiAnYWJvdXQgYSBtaW51dGUnLFxuICAgICAgbWludXRlczogJyVkIG1pbnV0ZXMnLFxuICAgICAgaG91cjogJ2Fib3V0IGFuIGhvdXInLFxuICAgICAgaG91cnM6ICclZCBob3VycycsXG4gICAgICBkYXk6ICdhIGRheScsXG4gICAgICBkYXlzOiAnJWQgZGF5cycsXG4gICAgICBtb250aDogJ2Fib3V0IGEgbW9udGgnLFxuICAgICAgbW9udGhzOiAnJWQgbW9udGhzJyxcbiAgICAgIHllYXI6ICdhYm91dCBhIHllYXInLFxuICAgICAgeWVhcnM6ICclZCB5ZWFycycsXG4gICAgICBudW1iZXJzOiBbXVxuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiB0cmltRGlnaXRzICggbnVtICkge1xuICAgICAgdmFyIG0gPSBudW0udG9TdHJpbmcoKS5zbGljZSgwLDEzKTtcbiAgICAgIHJldHVybiAobS5sZW5ndGggPT0gMTMpPyBwYXJzZUludChtKSA6IG51bTtcbiAgfVxuXG4gIHNlcnZpY2UuaW5Xb3JkcyA9IGZ1bmN0aW9uIChkaXN0YW5jZU1pbGxpcykge1xuICAgIHZhciAkbCA9IHNlcnZpY2Uuc2V0dGluZ3Muc3RyaW5ncztcbiAgICB2YXIgcHJlZml4ID0gJGwucHJlZml4QWdvO1xuICAgIHZhciBzdWZmaXggPSAkbC5zdWZmaXhBZ287XG4gICAgaWYgKHNlcnZpY2Uuc2V0dGluZ3MuYWxsb3dGdXR1cmUpIHtcbiAgICAgIGlmIChkaXN0YW5jZU1pbGxpcyA8IDApIHtcbiAgICAgICAgcHJlZml4ID0gJGwucHJlZml4RnJvbU5vdztcbiAgICAgICAgc3VmZml4ID0gJGwuc3VmZml4RnJvbU5vdztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgc2Vjb25kcyA9IE1hdGguYWJzKGRpc3RhbmNlTWlsbGlzKSAvIDEwMDA7XG4gICAgdmFyIG1pbnV0ZXMgPSBzZWNvbmRzIC8gNjA7XG4gICAgdmFyIGhvdXJzID0gbWludXRlcyAvIDYwO1xuICAgIHZhciBkYXlzID0gaG91cnMgLyAyNDtcbiAgICB2YXIgeWVhcnMgPSBkYXlzIC8gMzY1O1xuXG4gICAgZnVuY3Rpb24gc3Vic3RpdHV0ZShzdHJpbmdPckZ1bmN0aW9uLCBudW1iZXIpIHtcbiAgICAgIHZhciBzdHJpbmcgPSBhbmd1bGFyLmlzRnVuY3Rpb24oc3RyaW5nT3JGdW5jdGlvbikgP1xuICAgICAgc3RyaW5nT3JGdW5jdGlvbihudW1iZXIsIGRpc3RhbmNlTWlsbGlzKSA6IHN0cmluZ09yRnVuY3Rpb247XG4gICAgICB2YXIgdmFsdWUgPSAoJGwubnVtYmVycyAmJiAkbC5udW1iZXJzW251bWJlcl0pIHx8IG51bWJlcjtcbiAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvJWQvaSwgdmFsdWUpO1xuICAgIH1cblxuICAgIHZhciB3b3JkcyA9IHNlY29uZHMgPCA0NSAmJiBzdWJzdGl0dXRlKCRsLnNlY29uZHMsIE1hdGgucm91bmQoc2Vjb25kcykpIHx8XG4gICAgICAgIHNlY29uZHMgPCA5MCAmJiBzdWJzdGl0dXRlKCRsLm1pbnV0ZSwgMSkgfHxcbiAgICAgICAgbWludXRlcyA8IDQ1ICYmIHN1YnN0aXR1dGUoJGwubWludXRlcywgTWF0aC5yb3VuZChtaW51dGVzKSkgfHxcbiAgICAgICAgbWludXRlcyA8IDkwICYmIHN1YnN0aXR1dGUoJGwuaG91ciwgMSkgfHxcbiAgICAgICAgaG91cnMgPCAyNCAmJiBzdWJzdGl0dXRlKCRsLmhvdXJzLCBNYXRoLnJvdW5kKGhvdXJzKSkgfHxcbiAgICAgICAgaG91cnMgPCA0MiAmJiBzdWJzdGl0dXRlKCRsLmRheSwgMSkgfHxcbiAgICAgICAgZGF5cyA8IDMwICYmIHN1YnN0aXR1dGUoJGwuZGF5cywgTWF0aC5yb3VuZChkYXlzKSkgfHxcbiAgICAgICAgZGF5cyA8IDQ1ICYmIHN1YnN0aXR1dGUoJGwubW9udGgsIDEpIHx8XG4gICAgICAgIGRheXMgPCAzNjUgJiYgc3Vic3RpdHV0ZSgkbC5tb250aHMsIE1hdGgucm91bmQoZGF5cyAvIDMwKSkgfHxcbiAgICAgICAgeWVhcnMgPCAxLjUgJiYgc3Vic3RpdHV0ZSgkbC55ZWFyLCAxKSB8fFxuICAgICAgICBzdWJzdGl0dXRlKCRsLnllYXJzLCBNYXRoLnJvdW5kKHllYXJzKSk7XG5cbiAgICB2YXIgc2VwYXJhdG9yID0gJGwud29yZFNlcGFyYXRvciA9PT0gdW5kZWZpbmVkID8gJyAnIDogJGwud29yZFNlcGFyYXRvcjtcbiAgICByZXR1cm4gW3ByZWZpeCwgd29yZHMsIHN1ZmZpeF0uam9pbihzZXBhcmF0b3IpLnRyaW0oKTtcbiAgfTtcblxuICBzZXJ2aWNlLnBhcnNlID0gZnVuY3Rpb24gKGlzbzg2MDEpIHtcbiAgICBpZiAoYW5ndWxhci5pc051bWJlcihpc284NjAxKSkge1xuICAgICAgaXNvODYwMSA9IGlzbzg2MDEgKyBcIlwiO1xuICAgICAgLy8gZm9ybWF0IGZvciBjb3JyZWN0IGxlbmd0aFxuICAgICAgdmFyIG9yaWdpbmFsVGltZXN0YW1wID0gdHJpbURpZ2l0cyggaXNvODYwMSApO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KG9yaWdpbmFsVGltZXN0YW1wLCAxMCk7XG4gICAgfVxuICAgIHZhciBzID0gKGlzbzg2MDEgfHwgJycpLnRyaW0oKTtcbiAgICBzID0gcy5yZXBsYWNlKC9cXC5cXGQrLywgJycpOyAvLyByZW1vdmUgbWlsbGlzZWNvbmRzXG4gICAgcyA9IHMucmVwbGFjZSgvLS8sICcvJykucmVwbGFjZSgvLS8sICcvJyk7XG4gICAgcyA9IHMucmVwbGFjZSgvVC8sICcgJykucmVwbGFjZSgvWi8sICcgVVRDJyk7XG4gICAgcyA9IHMucmVwbGFjZSgvKFtcXCtcXC1dXFxkXFxkKVxcOj8oXFxkXFxkKS8sICcgJDEkMicpOyAvLyAtMDQ6MDAgLT4gLTA0MDBcbiAgICByZXR1cm4gbmV3IERhdGUocyk7XG4gIH07XG5cbiAgcmV0dXJuIHNlcnZpY2U7XG59KTtcbiIsIk1VRy5mYWN0b3J5KCdub3dUaW1lJyxcblsnJHRpbWVvdXQnLFxuZnVuY3Rpb24oJHRpbWVvdXQpIHtcbiAgdmFyIG5vd1RpbWUgPSBEYXRlLm5vdygpO1xuICB2YXIgdXBkYXRlVGltZSA9IGZ1bmN0aW9uKCkge1xuICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgbm93VGltZSA9IERhdGUubm93KCk7XG4gICAgICB1cGRhdGVUaW1lKCk7XG4gICAgfSwgMTAwMCk7XG4gIH07XG5cbiAgdXBkYXRlVGltZSgpO1xuICByZXR1cm4ge1xuICAgIGdldFRpbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIG5vd1RpbWU7XG4gICAgfVxuICB9O1xufV0pO1xuIiwidmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcblxuTVVHLmZhY3RvcnkoJ1Byb2plY3RzJyxcblsnJHEnLFxuZnVuY3Rpb24oJHEpIHtcbiAgLy8gQ29uZmlnIHRoZSBtYWluIHBhdGhzXG4gIHZhciBwcm9qZWN0c1BhdGggPSBfX2Rpcm5hbWUgKyAnL3Byb2plY3RzLmpzb24nO1xuICB2YXIgcHJvamVjdEZpbGVzUGF0aCA9IF9fZGlybmFtZSArICcvcHJvamVjdHMvJztcblxuICAvLyBDcmVhdGVzIGEgVVVJRCBvZiB0aGUgc3BlY2lmaWVkIGxlbmd0aFxuICBmdW5jdGlvbiBjcmVhdGVVVUlEKHMpIHtcbiAgICB2YXIgbjtcbiAgICBpZiAodHlwZW9mIHMgPT0gJ251bWJlcicgJiYgcyA9PT0gcGFyc2VJbnQocywgMTApKSB7XG4gICAgICBzID0gQXJyYXkocyArIDEpLmpvaW4oJ3gnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcy5yZXBsYWNlKC94L2csIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG4gPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiA2MSkgKyA0ODtcbiAgICAgIG4gPSBuID4gNTcgPyAobiArIDcgPiA5MCA/IG4gKyAxMyA6IG4gKyA3KSA6IG47XG4gICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIENyZWF0ZXMgYSBKU09OIG9iamVjdCBmb3IgYSBiYXNlbGluZSBuZXcgcHJvamVjdFxuICBmdW5jdGlvbiBjcmVhdGVEdW1teVByb2plY3QodG90YWwpIHtcbiAgICB0b3RhbCA9IHRvdGFsIHx8IDA7XG4gICAgdmFyIHByb2plY3RJZCA9IGNyZWF0ZVVVSUQoMTIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogcHJvamVjdElkLFxuICAgICAgdGl0bGU6ICdQcm9qZWN0ICcgKyAocGFyc2VJbnQodG90YWwsIDEwKSArIDEpLFxuICAgICAgdGltZXN0YW1wOiAoK25ldyBEYXRlKSxcbiAgICAgIHRvdGFsczoge1xuICAgICAgICBzdWNjZXNzOiBudWxsLFxuICAgICAgICB3YXJuaW5nOiBudWxsLFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgdmlld3M6IDBcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gU2V0cyB1cCB0aGUgbmVlZGVkIGJhc2UgZGF0YSBmb3Igc3RvcmluZyBhbiBpbmRpdmlkdWFsIHByb2plY3RcbiAgZnVuY3Rpb24gY3JlYXRlRHVtbXlQcm9qZWN0RmlsZShvcHRpb25zKSB7XG4gICAgdmFyIHByb2plY3RJZCA9IGNyZWF0ZVVVSUQoMTIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogb3B0aW9ucy5pZCxcbiAgICAgIHRpdGxlOiBvcHRpb25zLnRpdGxlLFxuICAgICAgdGltZXN0YW1wOiBvcHRpb25zLnRpbWVzdGFtcCxcbiAgICAgIHZpZXdwb3J0czogW10sXG4gICAgICBzZWxlY3RvcnM6IFtdLFxuICAgICAgY29va2llczogW10sXG4gICAgICBtZXRhOiB7XG4gICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgcmVhZHlFdmVudDogbnVsbCxcbiAgICAgICAgZGVsYXk6IG51bGwsXG4gICAgICAgIG1pc01hdGNoVGhyZXNob2xkOiBudWxsXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiB7XG5cbiAgICAvKipcbiAgICAgKiBjcmVhdGVzIGEgbmV3IHByb2plY3QsIGFuZCByZXR1cm5zIHRoZSBkYXRhIGluIGEgcHJvbWlzZVxuICAgICAqL1xuICAgIGNyZWF0ZU5ldzogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGZkID0gJHEuZGVmZXIoKTtcbiAgICAgIHZhciBhbGxQcm9qZWN0cyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHByb2plY3RzUGF0aCwgJ3V0ZjgnKSk7XG4gICAgICB2YXIgbmV3UHJvamVjdERhdGEgPSBjcmVhdGVEdW1teVByb2plY3QoYWxsUHJvamVjdHMubGVuZ3RoKTtcbiAgICAgIHZhciBuZXdQcm9qZWN0RmlsZSA9IGNyZWF0ZUR1bW15UHJvamVjdEZpbGUobmV3UHJvamVjdERhdGEpO1xuXG4gICAgICBhbGxQcm9qZWN0cy51bnNoaWZ0KG5ld1Byb2plY3REYXRhKTtcblxuICAgICAgLy8gc2F2ZSB0aGUgZGF0YSB0byB0aGUgcHJvamVjdHMgbGlzdFxuICAgICAgZnMud3JpdGVGaWxlKHByb2plY3RzUGF0aCwgSlNPTi5zdHJpbmdpZnkoYWxsUHJvamVjdHMpLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGRmZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzYXZlIGFzIGFuIGluZGl2aWR1YWwgZmlsZVxuICAgICAgICBmcy53cml0ZUZpbGUocHJvamVjdEZpbGVzUGF0aCArIG5ld1Byb2plY3REYXRhLmlkICsgJy5qc29uJywgSlNPTi5zdHJpbmdpZnkobmV3UHJvamVjdEZpbGUpLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcmVkaXJlY3QgdXNlciB0byB0aGUgc2V0dGluZ3MgcGFnZVxuICAgICAgICAgIGRmZC5yZXNvbHZlKG5ld1Byb2plY3REYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBnZXRBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHByb2plY3RzUGF0aCwgJ3V0ZjgnKSk7XG4gICAgfSxcblxuICAgIGdldEJ5SWQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocHJvamVjdEZpbGVzUGF0aCArIGlkICsgJy5qc29uJywgJ3V0ZjgnKSk7XG4gICAgfSxcblxuICAgIC8vIHNhdmUgdG8gZmlsZSBhbmQgbGlzdHMsIHJldHVybiBsaXN0IGRhdGFcbiAgICBzYXZlOiBmdW5jdGlvbihwcm9qZWN0RGF0YSkge1xuICAgICAgdmFyIGRmZCA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgYWxsUHJvamVjdHMgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwcm9qZWN0c1BhdGgsICd1dGY4JykpO1xuXG4gICAgICAvLyBVcGRhdGUgdGhlIGxpc3RpbmcgZGF0YVxuICAgICAgYWxsUHJvamVjdHMubWFwKGZ1bmN0aW9uKG9iaiwgaWR4KSB7XG4gICAgICAgIGlmIChvYmouaWQgPT09IHByb2plY3REYXRhLmlkKSB7XG4gICAgICAgICAgYWxsUHJvamVjdHNbaWR4XS50aXRsZSA9IHByb2plY3REYXRhLnRpdGxlO1xuICAgICAgICAgIGFsbFByb2plY3RzW2lkeF0udGltZXN0YW1wID0gKCtuZXcgRGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBzYXZlIGFzIGFuIGluZGl2aWR1YWwgZmlsZVxuICAgICAgZnMud3JpdGVGaWxlKHByb2plY3RGaWxlc1BhdGggKyBwcm9qZWN0RGF0YS5pZCArICcuanNvbicsIEpTT04uc3RyaW5naWZ5KHByb2plY3REYXRhKSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBsaXN0aW5nIGRhdGFcbiAgICAgICAgZnMud3JpdGVGaWxlKHByb2plY3RzUGF0aCwgSlNPTi5zdHJpbmdpZnkoYWxsUHJvamVjdHMpLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcmV0dXJuIHRoZSBsaXN0aW5nIGRhdGEsIHNvIHdlIGNhbiB1cGRhdGUgdGhlIHNpZGVwYW5lbFxuICAgICAgICAgIGRmZC5yZXNvbHZlKHByb2plY3REYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICAvLyBSZW1vdmVzIGEgc2luZ2xlIHByb2plY3QgYnkgSURcbiAgICByZW1vdmU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICB2YXIgZGZkID0gJHEuZGVmZXIoKTtcbiAgICAgIHZhciBhbGxQcm9qZWN0cyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHByb2plY3RzUGF0aCwgJ3V0ZjgnKSk7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgbGlzdGluZyBkYXRhXG4gICAgICBhbGxQcm9qZWN0cy5tYXAoZnVuY3Rpb24ob2JqLCBpZHgpIHtcbiAgICAgICAgaWYgKG9iai5pZCA9PT0gaWQpIHtcbiAgICAgICAgICBhbGxQcm9qZWN0cy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgcHJvamVjdCBmaWxlXG4gICAgICBmcy51bmxpbmsocHJvamVjdEZpbGVzUGF0aCArIGlkICsgJy5qc29uJywgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBsaXN0aW5nIGRhdGFcbiAgICAgICAgZnMud3JpdGVGaWxlKHByb2plY3RzUGF0aCwgSlNPTi5zdHJpbmdpZnkoYWxsUHJvamVjdHMpLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcmV0dXJuXG4gICAgICAgICAgZGZkLnJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xuICAgIH1cbiAgfTtcbn1dKTtcbiIsIk1VRy5maWx0ZXIoJ3RpbWVBZ28nLFxuWydub3dUaW1lJywgJ3RpbWVBZ28nLFxuZnVuY3Rpb24gKG5vd1RpbWUsIHRpbWVBZ28pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhciBmcm9tVGltZSA9IHRpbWVBZ28ucGFyc2UodmFsdWUpO1xuICAgIHZhciBkaWZmID0gbm93VGltZS5nZXRUaW1lKCkgLSBmcm9tVGltZTtcbiAgICByZXR1cm4gdGltZUFnby5pbldvcmRzKGRpZmYpO1xuICB9O1xufV0pO1xuIiwiTVVHLmNvbnRyb2xsZXIoJ01haW5DdHJsJyxcblsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJHN0YXRlJywgJ0NvbmZpZycsICdQcm9qZWN0cycsXG5mdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgQ29uZmlnLCBQcm9qZWN0cykge1xuICAkcm9vdFNjb3BlLmN1cnJlbnRQcm9qZWN0SWQgPSAnJztcblxuICAkc2NvcGUuY3JlYXRlTmV3UHJvamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgIFByb2plY3RzLmNyZWF0ZU5ldygpLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ1NJREVQQU5FTDpORVdQUk9KRUNUJywgcmVzKTtcbiAgICAgICRzdGF0ZS5nbygncHJvamVjdHMuc2V0dGluZ3MnLCB7IGlkOiByZXMuaWQgfSk7XG4gICAgfSxcblxuICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycik7XG4gICAgfSk7XG4gIH07XG5cbn1dKTtcbiIsIk1VRy5jb250cm9sbGVyKCdQcm9qZWN0Q3RybCcsXG5bJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRzdGF0ZVBhcmFtcycsICdQcm9qZWN0cycsXG5mdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZVBhcmFtcywgUHJvamVjdHMpIHtcblxuICAvLyBBbGxvdyB0aGUgY2hpbGQgdmlld3MgdG8gYmluZCB0byBzYW1lIHNjb3BlXG4gICRyb290U2NvcGUucHJvamVjdCA9IFByb2plY3RzLmdldEJ5SWQoJHN0YXRlUGFyYW1zLmlkKTtcblxufV0pO1xuIiwiTVVHLmNvbnRyb2xsZXIoJ1Byb2plY3RIaXN0b3J5Q3RybCcsXG5bJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJ1Byb2plY3RzJyxcbmZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgUHJvamVjdHMpIHtcblxuICAvLyBBbGxvdyB0aGUgY2hpbGQgdmlld3MgdG8gYmluZCB0byBzYW1lIHNjb3BlXG4gIC8vICRyb290U2NvcGUucHJvamVjdCA9IFByb2plY3RzLmdldEJ5SWQoJHN0YXRlUGFyYW1zLmlkKTtcblxufV0pO1xuIiwiTVVHLmNvbnRyb2xsZXIoJ1Byb2plY3RSdW5uZXJDdHJsJyxcblsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnUHJvamVjdHMnLFxuZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCBQcm9qZWN0cykge1xuXG4gIC8vIEFsbG93IHRoZSBjaGlsZCB2aWV3cyB0byBiaW5kIHRvIHNhbWUgc2NvcGVcbiAgLy8gJHJvb3RTY29wZS5wcm9qZWN0ID0gUHJvamVjdHMuZ2V0QnlJZCgkc3RhdGVQYXJhbXMuaWQpO1xuXG59XSk7XG4iLCJNVUcuY29udHJvbGxlcignUHJvamVjdFNldHRpbmdzQ3RybCcsXG5bJyRyb290U2NvcGUnLCAnJHNjb3BlJywgJyRzdGF0ZScsICdQcm9qZWN0cycsXG5mdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgUHJvamVjdHMpIHtcbiAgJHNjb3BlLm1hc3RlciA9IHt9O1xuICBhbmd1bGFyLmNvcHkoJHJvb3RTY29wZS5wcm9qZWN0LCAkc2NvcGUubWFzdGVyKTtcblxuICAvLyBUT0RPOiBzZXR1cCB2YWxpZGF0aW9uc1xuICAvLyBzYXZlIHRoZSBjdXJyZW50IHByb2plY3RcbiAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICBQcm9qZWN0cy5zYXZlKCRyb290U2NvcGUucHJvamVjdClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAvLyBVcGRhdGUgdGhlIHNpZGViYXIgd2l0aCBjaGFuZ2VzXG4gICAgICAgICRyb290U2NvcGUuJGVtaXQoJ1NJREVQQU5FTDpVUERBVEUnLCByZXMpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgcmV2ZXJ0IG1vZGVsXG4gICAgICAgIGFuZ3VsYXIuY29weSgkcm9vdFNjb3BlLnByb2plY3QsICRzY29wZS5tYXN0ZXIpO1xuICAgICAgfSxcblxuICAgICAgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpO1xuICAgICAgfSk7XG4gIH07XG5cbiAgLy8gcmV2ZXJ0IHRoZSBjdXJyZW50IHByb2plY3RcbiAgJHNjb3BlLmNhbmNlbFNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3VyZSA9IGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciBhbGwgeW91ciBjaGFuZ2VzPycpO1xuICAgIGlmIChzdXJlKSB7XG4gICAgICAvLyBwdXQgcmV2ZXJ0IG1vZGVsIGludG8gdGhlIHByb2plY3QgbW9kZWxcbiAgICAgIGFuZ3VsYXIuY29weSgkc2NvcGUubWFzdGVyLCAkcm9vdFNjb3BlLnByb2plY3QpO1xuICAgIH1cbiAgfTtcblxuICAvLyBkZWxldGUgdGhlIHByb2plY3QsIGFuZCByZW1vdmUgZnJvbSBwcm9qZWN0IGxpc3RzLCB0aGVuIHJlZGlyZWN0IHRvIG1haW5cbiAgJHNjb3BlLmRlbGV0ZVByb2plY3QgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3VyZSA9IGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBwcm9qZWN0PycpO1xuICAgIGlmIChzdXJlKSB7XG4gICAgICB2YXIgcHJvamVjdElEID0gJHJvb3RTY29wZS5wcm9qZWN0LmlkO1xuXG4gICAgICBQcm9qZWN0cy5yZW1vdmUocHJvamVjdElEKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdTSURFUEFORUw6UkVNT1ZFJywgeyBpZDogcHJvamVjdElEIH0pO1xuICAgICAgICAgICRzdGF0ZS5nbygnbWFpbicpO1xuICAgICAgICAgICRyb290U2NvcGUucHJvamVjdCA9IHt9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxufV0pO1xuIiwidmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcblxuTVVHLmNvbnRyb2xsZXIoJ1NpZGVQYW5lbEN0cmwnLFxuWyckcm9vdFNjb3BlJywgJyRzY29wZScsICckc3RhdGUnLCAnUHJvamVjdHMnLFxuZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkc3RhdGUsIFByb2plY3RzKSB7XG4gICRzY29wZS5wcm9qZWN0cyA9IFtdO1xuXG4gIC8vIGdyYWIgYWxsIHByb2plY3RzIGxpc3RcbiAgJHNjb3BlLnByb2plY3RzID0gUHJvamVjdHMuZ2V0QWxsKCk7XG5cbiAgLy8gYWRkIG5ldyBwcm9qZWN0IHRvIHRoZSBwcm9qZWN0cyBsaXN0XG4gICRyb290U2NvcGUuJG9uKCdTSURFUEFORUw6TkVXUFJPSkVDVCcsIGZ1bmN0aW9uKGUsIGFyZ3MpIHtcbiAgICBpZiAoIWFyZ3MgfHwgIWFyZ3MuaWQpIHsgcmV0dXJuOyB9XG5cbiAgICAkc2NvcGUucHJvamVjdHMudW5zaGlmdChhcmdzKTtcbiAgfSk7XG5cbiAgLy8gdXBkYXRlIHRoZSBwcm9qZWN0cyBsaXN0XG4gICRyb290U2NvcGUuJG9uKCdTSURFUEFORUw6VVBEQVRFJywgZnVuY3Rpb24oZSwgYXJncykge1xuICAgIGlmICghYXJncyB8fCAhYXJncy5pZCkgeyByZXR1cm47IH1cblxuICAgICRzY29wZS5wcm9qZWN0cy5tYXAoZnVuY3Rpb24ob2JqLCBpZHgpIHtcbiAgICAgIGlmIChvYmouaWQgPT09IGFyZ3MuaWQpIHtcbiAgICAgICAgJHNjb3BlLnByb2plY3RzW2lkeF0gPSBhcmdzO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICAvLyB1cGRhdGUgdGhlIHByb2plY3RzIGxpc3RcbiAgJHJvb3RTY29wZS4kb24oJ1NJREVQQU5FTDpSRU1PVkUnLCBmdW5jdGlvbihlLCBhcmdzKSB7XG4gICAgaWYgKCFhcmdzIHx8ICFhcmdzLmlkKSB7IHJldHVybjsgfVxuXG4gICAgJHNjb3BlLnByb2plY3RzLm1hcChmdW5jdGlvbihvYmosIGlkeCkge1xuICAgICAgaWYgKG9iai5pZCA9PT0gYXJncy5pZCkge1xuICAgICAgICAkc2NvcGUucHJvamVjdHMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gICRzY29wZS5nb1RvUHJvamVjdCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIHR5cGUgPSAnc2V0dGluZ3MnO1xuXG4gICAgLy8gVE9ETzogc2V0dXAgdG8gZmlndXJlIG91dCBpZiB3ZSBuZWVkIHRvIGdvIHRvIHNldHRpbmdzLCBvdGhlcndpc2UgZ28gdG8gcnVubmVyXG4gICAgJHN0YXRlLmdvKCdwcm9qZWN0cy4nICsgdHlwZSwgeyBpZDogaWQgfSk7XG4gICAgJHJvb3RTY29wZS5jdXJyZW50UHJvamVjdElkID0gaWQ7XG4gIH1cblxufV0pO1xuIiwiLyoqXG4gKiBDb25maWdcbiAqL1xuTVVHLmNvbnN0YW50KFwiQ29uZmlnXCIsIHtcbiAgXCJFTlZcIjogXCJTVEFHRVwiLFxuICBcIlNUQUdFXCI6IHtcbiAgfSxcbiAgXCJQUk9EXCI6IHtcbiAgfVxufSk7XG4iLCJNVUcuY29uZmlnKFxuWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLFxuZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gIC8vIFJvdXRlc1xuICAvLyAvXG4gIC8vIC9wcm9qZWN0c1xuICAvLyAvcHJvamVjdHMvOmlkL3J1bm5lclxuICAvLyAvcHJvamVjdHMvOmlkL2hpc3RvcnlcbiAgLy8gL3Byb2plY3RzLzppZC9zZXR0aW5nc1xuXG4gICRzdGF0ZVByb3ZpZGVyXG5cbiAgLyoqXG4gICAqIEJhc2UgUm91dGVcbiAgICovXG4gIC5zdGF0ZSgnbWFpbicsIHtcbiAgICB1cmw6ICcvJyxcbiAgICB0ZW1wbGF0ZVVybDogJ21haW4uaHRtbCdcbiAgfSlcblxuICAvKipcbiAgICogUHJvamVjdCBSb3V0ZXNcbiAgICovXG4gIC5zdGF0ZSgncHJvamVjdHMnLCB7XG4gICAgdXJsOiAnL3Byb2plY3RzLzppZCcsXG4gICAgdGVtcGxhdGVVcmw6ICdwcm9qZWN0cy5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnUHJvamVjdEN0cmwnXG4gIH0pXG4gIC5zdGF0ZSgncHJvamVjdHMuc2V0dGluZ3MnLCB7XG4gICAgdXJsOiAnL3NldHRpbmdzJyxcbiAgICB0ZW1wbGF0ZVVybDogJ3Byb2plY3RzLnNldHRpbmdzLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdQcm9qZWN0U2V0dGluZ3NDdHJsJ1xuICB9KVxuICAuc3RhdGUoJ3Byb2plY3RzLnJ1bm5lcicsIHtcbiAgICB1cmw6ICcvcnVubmVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJ3Byb2plY3RzLnJ1bm5lci5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnUHJvamVjdFJ1bm5lckN0cmwnXG4gIH0pXG4gIC5zdGF0ZSgncHJvamVjdHMuaGlzdG9yeScsIHtcbiAgICB1cmw6ICcvaGlzdG9yeScsXG4gICAgdGVtcGxhdGVVcmw6ICdwcm9qZWN0cy5oaXN0b3J5Lmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdQcm9qZWN0SGlzdG9yeUN0cmwnXG4gIH0pXG5cbiAgLyoqXG4gICAqIFN0YXRpYyBSb3V0ZXNcbiAgICovXG5cbiAgLy8gLnN0YXRlKCdtYWluLjQwNCcsIHtcbiAgLy8gICAgIHVybDogXCIvNDA0XCIsXG4gIC8vICAgICB0ZW1wbGF0ZVVybDogXCJ0ZW1wbGF0ZXMvNDA0Lmh0bWxcIixcbiAgLy8gICAgIGlzRXh0ZXJuYWw6IHRydWVcbiAgLy8gfSlcblxuICAvLyBFbmQgb2YgdGhlIHdvcmxkXG4gIDtcblxuICAvLyB1cmwgcmUtcm91dGluZ1xuICAvLyAkdXJsUm91dGVyUHJvdmlkZXJcbiAgLy8gICAud2hlbignL3Byb2plY3RzJywgJy8nKVxuICAvLyAgIC53aGVuKCcvcHJvamVjdHMvJywgJy8nKTtcblxuICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSBzdGF0ZXMgYXJlIG1hdGNoZWQsIHVzZSB0aGlzIGFzIHRoZSBmYWxsYmFja1xuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59XSk7XG4iLCJNVUcucnVuKFsnJHJvb3RTY29wZScsICckaHR0cCcsXG5mdW5jdGlvbigkcm9vdFNjb3BlLCAkaHR0cCkge1xuXG4gIC8vIGhlYWRlcnNcbiAgdmFyICRjb21tb24gPSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbjtcbiAgJGNvbW1vblsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7XG5cbiAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgY29uc29sZS5sb2coJyRzdGF0ZUNoYW5nZUVycm9yJywgZXJyb3IpO1xuICB9KTtcblxufV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9